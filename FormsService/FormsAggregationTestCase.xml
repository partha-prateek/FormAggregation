<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="cd328411-36cb-4bc7-b96a-25615f9fa318" discardOkResults="true" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="FormsAggregationTestCase" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="cd328411-36cb-4bc7-b96a-25615f9fa318fileName">FormsAggregationTestCase</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="restrequest" name="GettingDataFromAPI" id="e300f490-9cb1-43de-9118-06be19560cd6"><con:settings/><con:config service="http://mavdv-ccpts-03.curaspan.local:8081" methodName="A" resourcePath="/formaggregationservice/services/form/1/episode/a" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GettingDataFromAPI" id="108d015e-6268-44e7-ad87-10ef819d4859" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>${#Project#URL}</con:endpoint><con:request/><con:originalUri>http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a</con:originalUri><con:assertion type="JsonPath Existence Match" id="a8e199bb-8fc6-4bd8-924b-c5a83c2e9b77" name="Check for existence of [id]"><con:configuration><path>$['id']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="57fb76a6-d23b-4ba5-aacb-bee084999674" name="Match content of [id]"><con:configuration><path>$['id']</path><content>450</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Count" id="06780830-68ef-4c1f-afc3-62cb5caf8118" name="Check count of [uri]"><con:configuration><path>$['uri']</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="e4be40f3-101e-428c-afc7-7a361c16c71e" name="Match content of [uri]"><con:configuration><path>$['uri']</path><content>Template_450.pdf</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="d9f156be-6df3-417a-bafb-0b875f585d99" name="Check for existence of [uri]"><con:configuration><path>$['uri']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="d7efdb61-292d-4474-aead-ff85a4abf1fd" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="XPath Match" id="3d5e9284-6a1b-4905-a0b9-3703b4d423a9" name="XPath Match_ID"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:id[1]</path><content>450</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="55974e61-113d-400e-8ac1-fdee25d85065" name="XPath Match_Page"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:page[1]</path><content>1.0</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="6e5d9543-3abc-4758-a07e-5c91646808b3" name="XPath Match_URI"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:uri[1]</path><content>Template_450.pdf</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="d167f7b0-3d06-4313-bfef-562099ca0c4a" name="XPath Match_ZIP"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:zip[1]</path><content>11111</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="98af0910-3ef5-4f8e-95d1-780694b03de2" name="XPath Match_NPI"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:npi_number[1]</path><content>NPI111111</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="b4b10aec-4107-4b85-b933-9ee73ad2008b" name="XPathMatch_Phone"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:x450_patient_work_phone[1]</path><content>(555) 555-5555</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="79a2d8f2-3cf3-4f42-a24a-f4e8d12f58ec" name="XPath Match_City"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:city[1]</path><content>Test City</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="c39eb506-b9b7-4d5d-904f-ba930f142775" name="XPath Match_Age"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:x450_age[1]</path><content>999</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="70f0da36-6cd1-4df4-80be-40c661d8733e" name="XPath Match_Weight"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:x450_patient_weight[1]</path><content>6</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="2930af64-6d2b-4ea2-a340-8a83b6394a1e" name="XPath Match_PrimaryPolicy"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:x450_primary_policy_number[1]</path><content>1234567890</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="28a44311-6c89-400d-9e2a-8098b79b6558" name="XPathMatchTestAdnType"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:x450_admission_type[1]</path><content>TEST ADMISSION TYPE</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="6a05788e-90c9-486b-a0a1-67e30171195d" name="XPath Match_PatientName"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:patient_name[1]</path><content>Patient Name, Test</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="8d91cd2b-6a4d-49b2-8dda-83ae4a51b166" name="XPath Match_Country"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:hospital_county[1]</path><content>Test Country</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="c340ba1d-3eb7-4533-9198-0be3f145dd95" name="XPathMatch_PatientPin"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:x450_patient_state_zip[1]</path><content>22222</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="25ece62d-73c8-4ce6-aae2-ae80d9f32abb" name="XPath Match_State"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:state[1]</path><content>Test State</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="32a7f0a3-cd80-4d1d-9e2a-1dd7424d6fa3" name="XPath Match_HospitalAddress"><con:configuration><path>declare namespace ns1='http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a';
//ns1:Response[1]/ns1:values[1]/ns1:hospital_address[1]</path><content>Hospital Test Address</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters>
  <con:entry key="episodekey" value="a"/>
  <con:entry key="id" value="2"/>
</con:parameters><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="MongoConnectionAndAssertions" id="35e0bd93-c063-4727-8fed-dbd1d36244c0"><con:settings/><con:config><script>import com.gmongo.GMongoClient
import com.mongodb.MongoClient
import com.gmongo.GMongo
import com.mongodb.MongoCredential
import com.mongodb.ServerAddress
import groovy.json.JsonSlurper
/*def dbUser = 'fduser'
def dbPassword = 'password1'
def dbServer = 'db-mongodev.curaspan.local'
def dbDatabase = 'forms'
*/
/*def dbUser = testRunner.testCase.testSuite.project.getPropertyValue("User")
def dbPassword = testRunner.testCase.testSuite.project.getPropertyValue("Password")
def dbServer = testRunner.testCase.testSuite.project.getPropertyValue("Server")

def dbDatabase = testRunner.testCase.testSuite.project.getPropertyValue("Database")
*/
def dbUser = context.expand( '${#Project#User}' )
def dbPassword = context.expand( '${#Project#Password}' )
def dbServer = context.expand( '${#Project#Server}' )
def dbDatabase = context.expand( '${#Project#Database}' )
//log.info(fixed)
//def dbDatabase = fixed("Database")
//Connection to Mongo DB 
def credentials = MongoCredential.createCredential(dbUser, dbDatabase, dbPassword as char[])

def mongoClient =  new MongoClient( new ServerAddress(dbServer), Arrays.asList(credentials) )
context.gmongo = new GMongo( mongoClient )
context.mongoDB = context.gmongo.getDB(dbDatabase)
log.info("Successfull")



def dbMongo = context.mongoDB.form.find([_id:[$exists:true]]).toArray()
log.info dbMongo[0]
def response = context.expand( '${GettingDataFromAPI#Response#$[\'id\']}' )
//def response = context.expand( '${GettingDataFromAPI#Response#$[\'id\']}' )

assert dbMongo[0]._id == response
log.info "Assertions Successfull"
assert dbMongo[0].name == "Patient Information Form"
//assert dbMongo[0].active == true
def response1 = context.expand( '${GettingDataFromAPI#Response#$[\'uri\']}' )
assert dbMongo[0].uri == response1
def response2 = context.expand( '${GettingDataFromAPI#Response#$[\'page\']}' )
log.info response2
//assert dbMongo[0].page ==  response2:"Failedyes"
//assert dbMongo[0].formFieldMap == 'normal_list'
log.info "Assertions Successfull"
//def id = context.expand( '${GettingDataFromAPI#id}' )

</script></con:config></con:testStep><con:testStep type="restrequest" name="REST Request" id="16dd878e-2948-4321-94bb-cf62cdd9ec37"><con:settings/><con:config service="http://mavdv-ccpts-03.curaspan.local:8081" methodName="A" resourcePath="/formaggregationservice/services/form/1/episode/a" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="83ae492e-d9e8-4fb6-9cb2-f47ab91fae81" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://mavdv-ccpts-03.curaspan.local:8081</con:endpoint><con:request/><con:originalUri>http://mavdv-ccpts-03.curaspan.local/formaggregationservice/services/form/1/episode/a</con:originalUri><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC Request" id="b400d70f-cbea-4ada-8b17-877641d058b1"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:query>${GettingDataFromAPI#Response#$['id']}${#Project#URL}</con:query><con:properties/></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>e300f490-9cb1-43de-9118-06be19560cd6</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>16dd878e-2948-4321-94bb-cf62cdd9ec37</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase>